addPolygons(
fillColor = ~pal(Normalized_Severity),  # <-- make sure this matches the legend
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
label = ~paste0("ZIP: ", ZCTA5CE20, "<br>",
"Normalized Severity Score: ", round(Normalized_Severity, 3))
) %>%
addLegend(
pal = pal,
values = ~Normalized_Severity,
title = "Opioid Normalized Severity Score",
position = "bottomright"
) %>%
addControl(
html = "<strong>Opioid Severity by ZIP Code (Riverside County)</strong>",
position = "topright"
)
install.packages(c("leaflet", "sf", "dplyr", "tigris","RColorBrewer"))
library(leaflet)
library(sf)
library(dplyr)
library(tigris)
library(RColorBrewer)
options(tigris_use_cache = TRUE)
# Load ZIP Code Tabulation Areas (ZCTAs)
zip_shapes <- tigris::zctas()
install.packages(c("leaflet", "sf", "dplyr", "tigris", "RColorBrewer"))
zip_shapes <- st_transform(zip_shapes, crs = 4326)
# Filter for Riverside County ZIPs (92501–92883 range)
riverside_zips <- zip_shapes %>%
filter(ZCTA5CE20 %in% severity_by_zip$`ZIP`)
map_data <- left_join(riverside_zips, severity_by_zip,
by = c("ZCTA5CE20" = "ZIP"))
pal <- colorNumeric(
palette = brewer.pal(9, "YlOrRd"),
domain = map_data$Normalized_Severity,
na.color = "transparent",
reverse = TRUE
)
opioid_map<-leaflet(map_data) %>%
addProviderTiles("CartoDB.Positron") %>%
addPolygons(
fillColor = ~pal(Normalized_Severity),  # <-- make sure this matches the legend
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
label = ~paste0("ZIP: ", ZCTA5CE20, "<br>",
"Normalized Severity Score: ", round(Normalized_Severity, 3))
) %>%
addLegend(
pal = pal,
values = ~Normalized_Severity,
title = "Opioid Normalized Severity Score",
position = "bottomright"
) %>%
addControl(
html = "<strong>Opioid Severity by ZIP Code (Riverside County)</strong>",
position = "topright"
)
print(opioid_map)
install.packages(c("leaflet", "sf", "dplyr", "tigris","RColorBrewer"))
library(leaflet)
library(sf)
library(dplyr)
library(tigris)
library(RColorBrewer)
options(tigris_use_cache = TRUE)
# Load ZIP Code Tabulation Areas (ZCTAs)
zip_shapes <- tigris::zctas()
install.packages(c("leaflet", "sf", "dplyr", "tigris", "RColorBrewer"))
zip_shapes <- st_transform(zip_shapes, crs = 4326)
# Filter for Riverside County ZIPs (92501–92883 range)
riverside_zips <- zip_shapes %>%
filter(ZCTA5CE20 %in% severity_by_zip$`ZIP`)
map_data <- left_join(riverside_zips, severity_by_zip,
by = c("ZCTA5CE20" = "ZIP"))
pal <- colorNumeric(
palette = brewer.pal(9, "YlOrRd"),
domain = map_data$Normalized_Severity,
na.color = "transparent",
reverse = FALSE
)
opioid_map<-leaflet(map_data) %>%
addProviderTiles("CartoDB.Positron") %>%
addPolygons(
fillColor = ~pal(Normalized_Severity),  # <-- make sure this matches the legend
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
label = ~paste0("ZIP: ", ZCTA5CE20, "<br>",
"Normalized Severity Score: ", round(Normalized_Severity, 3))
) %>%
addLegend(
pal = pal,
values = ~Normalized_Severity,
title = "Opioid Normalized Severity Score",
position = "bottomright"
) %>%
addControl(
html = "<strong>Opioid Severity by ZIP Code (Riverside County)</strong>",
position = "topright"
)
print(opioid_map)
library(leaflet)
library(sf)
library(dplyr)
library(tigris)
library(RColorBrewer)
options(tigris_use_cache = TRUE)
# Load ZIP Code Tabulation Areas (ZCTAs)
zip_shapes <- tigris::zctas()
zip_shapes <- st_transform(zip_shapes, crs = 4326)
# Filter for Riverside County ZIPs (92501–92883 range)
riverside_zips <- zip_shapes %>%
filter(ZCTA5CE20 %in% severity_by_zip$`ZIP`)
map_data <- left_join(riverside_zips, severity_by_zip,
by = c("ZCTA5CE20" = "ZIP"))
pal <- colorNumeric(
palette = brewer.pal(9, "YlOrRd"),
domain = map_data$Normalized_Severity,
na.color = "transparent",
reverse = FALSE
)
opioid_map<-leaflet(map_data) %>%
addProviderTiles("CartoDB.Positron") %>%
addPolygons(
fillColor = ~pal(Normalized_Severity),  # <-- make sure this matches the legend
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
label = ~paste0("ZIP: ", ZCTA5CE20, "<br>",
"Normalized Severity Score: ", round(Normalized_Severity, 3))
) %>%
addLegend(
pal = pal,
values = ~Normalized_Severity,
title = "Opioid Normalized Severity Score",
position = "bottomright"
) %>%
addControl(
html = "<strong>Opioid Severity by ZIP Code (Riverside County)</strong>",
position = "topright"
) %>%
addControl(
html = "<em>Higher scores indicate more severe opioid-related health outcomes</em>",
position = "bottomleft"
)
print(opioid_map)
library(leaflet)
library(sf)
library(dplyr)
library(tigris)
library(RColorBrewer)
options(tigris_use_cache = TRUE)
# Load ZIP Code Tabulation Areas (ZCTAs)
zip_shapes <- tigris::zctas()
zip_shapes <- st_transform(zip_shapes, crs = 4326)
# Filter for Riverside County ZIPs (92501–92883 range)
riverside_zips <- zip_shapes %>%
filter(ZCTA5CE20 %in% severity_by_zip$`ZIP`)
map_data <- left_join(riverside_zips, severity_by_zip,
by = c("ZCTA5CE20" = "ZIP"))
pal <- colorNumeric(
palette = brewer.pal(9, "YlOrRd"),
domain = map_data$Normalized_Severity,
na.color = "transparent",
reverse = FALSE
)
opioid_map<-leaflet(map_data) %>%
addProviderTiles("CartoDB.Positron") %>%
addPolygons(
fillColor = ~pal(Normalized_Severity),  # <-- make sure this matches the legend
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
label = ~paste0("ZIP: ", ZCTA5CE20, "<br>",
"Normalized Severity Score: ", round(Normalized_Severity, 3))
) %>%
addLegend(
pal = pal,
values = ~Normalized_Severity,
title = "Opioid Normalized Severity Score",
position = "bottomright"
) %>%
addControl(
html = "<strong>Opioid Severity by ZIP Code (Riverside County)</strong>",
position = "topright"
) %>%
addControl(
html = "<br><em>Higher scores indicate more severe opioid-related health outcomes</em>",
position = "bottomleft"
)
print(opioid_map)
library(leaflet)
library(sf)
library(dplyr)
library(tigris)
library(RColorBrewer)
options(tigris_use_cache = TRUE)
# Load ZIP Code Tabulation Areas (ZCTAs)
zip_shapes <- tigris::zctas()
zip_shapes <- st_transform(zip_shapes, crs = 4326)
# Filter for Riverside County ZIPs (92501–92883 range)
riverside_zips <- zip_shapes %>%
filter(ZCTA5CE20 %in% severity_by_zip$`ZIP`)
map_data <- left_join(riverside_zips, severity_by_zip,
by = c("ZCTA5CE20" = "ZIP"))
pal <- colorNumeric(
palette = brewer.pal(9, "YlOrRd"),
domain = map_data$Normalized_Severity,
na.color = "transparent",
reverse = FALSE
)
opioid_map<-leaflet(map_data) %>%
addProviderTiles("CartoDB.Positron") %>%
addPolygons(
fillColor = ~pal(Normalized_Severity),  # <-- make sure this matches the legend
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
label = ~paste0("ZIP: ", ZCTA5CE20, "<br>",
"Normalized Severity Score: ", round(Normalized_Severity, 3))
) %>%
addLegend(
pal = pal,
values = ~Normalized_Severity,
title = HTML("Opioid Severity Score<br><small><em>Higher = More Severe</em></small>"),
position = "bottomright"
)
opioid_map<-leaflet(map_data) %>%
addProviderTiles("CartoDB.Positron") %>%
addPolygons(
fillColor = ~pal(Normalized_Severity),  # <-- make sure this matches the legend
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
label = ~paste0("ZIP: ", ZCTA5CE20, "<br>",
"Normalized Severity Score: ", round(Normalized_Severity, 3))
) %>%
addLegend(
pal = pal,
values = ~Normalized_Severity,
title = HTML("Opioid Severity Score<br><small><em>Higher = More Severe</em></small>"),
position = "bottomright"
)  %>%
addControl(
html = "<strong>Opioid Severity by ZIP Code (Riverside County)</strong>",
position = "topright"
)
library(htmltools)
opioid_map<-leaflet(map_data) %>%
addProviderTiles("CartoDB.Positron") %>%
addPolygons(
fillColor = ~pal(Normalized_Severity),  # <-- make sure this matches the legend
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
label = ~paste0("ZIP: ", ZCTA5CE20, "<br>",
"Normalized Severity Score: ", round(Normalized_Severity, 3))
) %>%
addLegend(
pal = pal,
values = ~Normalized_Severity,
title = HTML("Opioid Severity Score<br><small><em>Higher = More Severe</em></small>"),
position = "bottomright"
)  %>%
addControl(
html = "<strong>Opioid Severity by ZIP Code (Riverside County)</strong>",
position = "topright"
)
print(opioid_map)
print(opioid_map)
View(opioid_map)
print(opioid_map)
View(map_data)
write.csv("map_data")
library(dplyr)
library(tidyverse)
setwd("~/Downloads")
ZIPcoeffs <- read.csv("poisson_coefficients1.csv")
above_poverty <- read.csv("filtered_abovepoverty_riverside.csv")
above_poverty <- above_poverty %>%
rename(ZIP = geoid)
merged_ZIPcoeffs_above_poverty <- merge(ZIPcoeffs, above_poverty, by = "ZIP", all.x = TRUE)
poverty_correlation_data <- merged_ZIPcoeffs_above_poverty %>%
select(percentile, Estimate) %>%
drop_na()  # Removes rows with NA values
leaflet(map_data) %>%
addProviderTiles("CartoDB.Positron") %>%
addPolygons(
fillColor = ~pal(Normalized_Severity),
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
label = ~paste0("ZIP: ", ZCTA5CE20, "<br>", "Normalized Severity Score: ", Normalized_Severity)
) %>%
addLegend(
position = "bottomright",
pal = pal,
values = ~Normalized_Severity,
title = HTML("Opioid Severity Score<br><small><em>Higher = More Severe</em></small>"),
labFormat = labelFormat(prefix = "<strong>", suffix = "</strong>")
) %>%
addControl(
html = "<strong>Opioid Severity by ZIP Code (Riverside County)</strong>",
position = "topright"
)
library(leaflet)
library(sf)
library(dplyr)
library(tigris)
library(RColorBrewer)
options(tigris_use_cache = TRUE)
# Load ZIP Code Tabulation Areas (ZCTAs)
zip_shapes <- tigris::zctas()
zip_shapes <- st_transform(zip_shapes, crs = 4326)
# Filter for Riverside County ZIPs (92501–92883 range)
riverside_zips <- zip_shapes %>%
filter(ZCTA5CE20 %in% severity_by_zip$`ZIP`)
map_data <- left_join(riverside_zips, severity_by_zip,
by = c("ZCTA5CE20" = "ZIP"))
pal <- colorNumeric(
palette = brewer.pal(9, "YlOrRd"),
domain = map_data$Normalized_Severity,
na.color = "transparent",
reverse = FALSE
)
leaflet(map_data) %>%
addProviderTiles("CartoDB.Positron") %>%
addPolygons(
fillColor = ~pal(Normalized_Severity),
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
label = ~paste0("ZIP: ", ZCTA5CE20, "<br>", "Normalized Severity Score: ", Normalized_Severity)
) %>%
addLegend(
position = "bottomright",
pal = pal,
values = ~Normalized_Severity,
title = HTML("Opioid Severity Score<br><small><em>Higher = More Severe</em></small>"),
labFormat = labelFormat(prefix = "<strong>", suffix = "</strong>")
) %>%
addControl(
html = "<strong>Opioid Severity by ZIP Code (Riverside County)</strong>",
position = "topright"
)
library(leaflet)
library(sf)
library(dplyr)
library(tigris)
library(RColorBrewer)
library(htmltools)
options(tigris_use_cache = TRUE)
# Load ZIP Code Tabulation Areas (ZCTAs)
zip_shapes <- tigris::zctas()
zip_shapes <- st_transform(zip_shapes, crs = 4326)
# Filter for Riverside County ZIPs (92501–92883 range)
riverside_zips <- zip_shapes %>%
filter(ZCTA5CE20 %in% severity_by_zip$`ZIP`)
map_data <- left_join(riverside_zips, severity_by_zip,
by = c("ZCTA5CE20" = "ZIP"))
pal <- colorNumeric(
palette = brewer.pal(9, "YlOrRd"),
domain = map_data$Normalized_Severity,
na.color = "transparent",
reverse = FALSE
)
leaflet(map_data) %>%
addProviderTiles("CartoDB.Positron") %>%
addPolygons(
fillColor = ~pal(Normalized_Severity),
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
label = ~paste0("ZIP: ", ZCTA5CE20, "<br>", "Normalized Severity Score: ", Normalized_Severity)
) %>%
addLegend(
position = "bottomright",
pal = pal,
values = ~Normalized_Severity,
title = HTML("Opioid Severity Score<br><small><em>Higher = More Severe</em></small>"),
labFormat = labelFormat(prefix = "<strong>", suffix = "</strong>")
) %>%
addControl(
html = "<strong>Opioid Severity by ZIP Code (Riverside County)</strong>",
position = "topright"
)
leaflet(map_data) %>%
addProviderTiles("CartoDB.Positron") %>%
addPolygons(
fillColor = ~pal(Normalized_Severity),
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
label = ~paste0("ZIP: ", ZCTA5CE20, "<br>", "Normalized Severity Score: ", Normalized_Severity)
) %>%
addLegend(
position = "bottomright",
pal = pal,
values = ~Normalized_Severity,
title = HTML("Opioid Severity Score<br><small><em>Higher = More Severe</em></small>"),
labFormat = labelFormat()
) %>%
addControl(
html = "<strong>Opioid Severity by ZIP Code (Riverside County)</strong>",
position = "topright"
)
leaflet(map_data) %>%
addProviderTiles("CartoDB.Positron") %>%
addPolygons(
fillColor = ~pal(Normalized_Severity),
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
label = ~lapply(paste0("ZIP: ", ZCTA5CE20, "<br>", "Normalized Severity Score: ", round(Normalized_Severity, 3)), HTML)
) %>%
addLegend(
position = "bottomright",
pal = pal,
values = ~Normalized_Severity,
title = HTML("Opioid Severity Score<br><small><em>Higher = More Severe</em></small>"),
labFormat = labelFormat()
) %>%
addControl(
html = "<strong>Opioid Severity by ZIP Code (Riverside County)</strong>",
position = "topright"
)
opioid_map<-leaflet(map_data) %>%
addProviderTiles("CartoDB.Positron") %>%
addPolygons(
fillColor = ~pal(Normalized_Severity),
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
label = ~lapply(paste0("ZIP: ", ZCTA5CE20, "<br>", "Normalized Severity Score: ", round(Normalized_Severity, 3)), HTML)
) %>%
addLegend(
position = "bottomright",
pal = pal,
values = ~Normalized_Severity,
title = HTML("Opioid Severity Score<br><small><em>Higher = More Severe</em></small>"),
labFormat = labelFormat()
) %>%
addControl(
html = "<strong>Opioid Severity by ZIP Code (Riverside County)</strong>",
position = "topright"
)
print(opioid_map)
library(dplyr)
library(tidyverse)
setwd("~/Downloads")
ZIPcoeffs <- read.csv("poisson_coefficients1.csv")
above_poverty <- read.csv("filtered_abovepoverty_riverside.csv")
above_poverty <- above_poverty %>%
rename(ZIP = geoid)
merged_ZIPcoeffs_above_poverty <- merge(ZIPcoeffs, above_poverty, by = "ZIP", all.x = TRUE)
poverty_correlation_data <- merged_ZIPcoeffs_above_poverty %>%
select(percentile, Estimate) %>%
drop_na()  # Removes rows with NA values
riv_hosp_data <- merge(riv_hosp_data, riv_pop_data, by = "ZIP", all.x = TRUE)
riv_hosp_data_clean <- riv_hosp_data
riv_hosp_data$Opioid_Overdose_Hospitalizations <- round((riv_hosp_data$Age.Adjusted.Rate / 100000) * riv_hosp_data$Count_Person)
riv_hosp_data <- merge(riv_hosp_data, riv_pop_data, by = "ZIP", all.x = TRUE)
riv_hosp_data_clean <- riv_hosp_data
riv_hosp_data_clean$Opioid_Overdose_Hospitalizations <- round((riv_hosp_data_clean$Age.Adjusted.Rate / 100000) * riv_hosp_data_clean$Count_Person)
riv_hosp_data_clean$ZIP <- as.factor(riv_hosp_data_clean$ZIP)# Ensure ZIP is a categorical factor
hosp_median <- median(filtered_riv_hosp_data_clean$Opioid_Overdose_Deaths, na.rm = TRUE)
hosp_ref_zip <- filtered_riv_hosp_data_clean %>%
mutate(Distance = abs(Opioid_Overdose_Hospitalizations - ed_median_visits)) %>%
arrange(Distance) %>%
slice(1) %>%
pull(ZIP)
print(paste("Reference ZIP:", hosp_ref_zip))
# Setting reference ZIP code
filtered_riv_hosp_data_clean$ZIP <- factor(filtered_riv_hosp_data_clean$ZIP)
filtered_riv_hosp_data_clean$ZIP <- relevel(filtered_riv_hosp_data_clean$ZIP, ref = "92591")
View(filtered_riv_ed_data_clean)
View(riv_pop_data)
summary(IRR_ed)
# Guards to make sure that both the robust tables *and* the fitted models to get the reference ZIP
need <- function(x) !exists(x, inherits = TRUE) || is.null(get(x, inherits = TRUE))
source("R/02_poisson_models.R")
